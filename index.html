<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="game.css">
    <meta charset="UTF-8">
    <title>Dexie</title>    
  </head>

  <body>
    <div id = "game">
      <canvas id = "c1"></canvas>      
    </div>
    
    <script>
      var c = document.getElementById("c1");
      var ctx = c.getContext("2d");
      ctx.canvas.width  = window.innerWidth-100;
      ctx.canvas.height = window.innerHeight-20;
      
      let player  = {x:10, y:c.height/2,w:120,h:50};
      
      let colors = ["red", "green"];
      
      
      const drawFilledRectangle = (x,y,w,h,color) => {
        ctx.beginPath();
        ctx.fillStyle = color;
        ctx.rect(x,y,w,h,color);
        ctx.closePath();
        ctx.stroke();
        ctx.fill();

      }
      
      /* takes in a circle object and a rectangle object
      formulas taken from http://www.jeffreythompson.org/collision-detection/rect-rect.php
      */
      const isColliding = (player, rectObj) => {
        if (player.x + player.w >= rectObj.x &&     // r1 right edge past r2 left
            player.x <= rectObj.x + rectObj.w &&       // r1 left edge past r2 right
            player.y + player.h >= rectObj.y &&       // r1 top edge past r2 bottom
            player.y <= rectObj.y + rectObj.h) {       // r1 bottom edge past r2 top
          return true;
        }
        return false;
        
      }
      
      // player movement
      document.addEventListener("keydown", (e) =>{
          if(e["key"] == "ArrowDown"){
            if(player["y"]+10 > c.height-player["h"]){
              player["y"] = player["y"];
            }
            else{
              player["y"] += 10;
            }
          } else if (e["key"] == "ArrowUp"){
            if(player["y"]-10 < 0 ){
              player["y"] = player["y"]
            }
            else{
              player["y"] -= 10;
            }
          }
        
        });
      
      var rect1 = {
        x: c.width,
        y: Math.floor(Math.random()*c.height),
        w: 60,
        h: 40,
        color: "red"
      }
      
      var rect2= {
        x: c.width,
        y: Math.floor(Math.random()*c.height),
        w: 60,
        h: 40,
        color: "green"
      }
      var rect3 = {
        x: c.width,
        y: Math.floor(Math.random()*c.height),
        w: 60,
        h: 40,
        color: "red"
      }
      
      var rect4= {
        x: c.width,
        y: Math.floor(Math.random()*c.height),
        w: 60,
        h: 40,
        color: "green"
      }
      
     
      
      var objects = [rect1, rect2, rect3, rect4]
      
      
      
      
      const draw = () => {

        //clear
        ctx.clearRect(0,0,c.width,c.height);
        
        
        
        //draw
        ctx.beginPath();
        ctx.fillStyle = "black";
        ctx.rect(player["x"], player["y"], player["w"],player["h"]);
        ctx.closePath();
        ctx.stroke();
        ctx.fill();
        
        for (i in objects){ 
          let rect = objects[i];
          rect.x -= 5
          
          if(rect.y > c.height-rect.h){
            rect.y = Math.floor(Math.random()*c.height);
            rect.x = c.width;
          }
          
          if(isColliding(player,rect) == true){
            rect.y = Math.floor(Math.random()*c.height);
            rect.x = c.width;
          }
          
          if(rect.x < 0){
            rect.y = Math.floor(Math.random()*c.height);
            rect.x = c.width;
          }
          
          
          

          drawFilledRectangle(rect.x, rect.y, rect.w, rect.h,rect.color);
        }       
        
        
        //repeat
        window.requestAnimationFrame(draw);
      }
      
      draw();
      
    </script>

  </body>

</html>