<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="game.css">
    <meta charset="UTF-8">
    <title>Dexie</title>    
  </head>

  <body>
    <div id = "game">
      <canvas id = "c1"></canvas>      
    </div>
    
    <script>
      var c = document.getElementById("c1");
      var ctx = c.getContext("2d");
      ctx.canvas.width  = window.innerWidth-100;
      ctx.canvas.height = window.innerHeight-20;
      
      let player  = {x:10, y:c.height/2,w:120,h:50};
      
      let colors = ["red", "green"];
      
      
      const drawFilledRectangle = (x,y,w,h,color) => {
        ctx.beginPath();
        ctx.fillStyle = color;
        ctx.rect(x,y,w,h,color);
        ctx.closePath();
        ctx.stroke();
        ctx.fill();

      }
      
      /* takes in a circle object and a rectangle object
      formulas taken from https://stackoverflow.com/questions/21089959/detecting-collision-of-rectangle-with-circle
      */
      const isColliding = (circle, rect) => {
        
         let deltaX = circle.x - Math.max(rect.x, Math.min(circle.x, rect.x + rect.w));
        
         let deltaY = circle.y - Math.max(rect.y, Math.min(circle.y, rect.y + rect.h));
         return (deltaX * deltaX + deltaY * deltaY) < (circle.r * circle.r);
        
      }
      
      // player movement
      document.addEventListener("keydown", (e) =>{
          if(e["key"] == "ArrowDown"){
            if(player["y"]+10 > c.height-player["h"]){
              player["y"] = player["y"];
            }
            else{
              player["y"] += 10;
            }
          } else if (e["key"] == "ArrowUp"){
            if(player["y"]-10 < 0 ){
              player["y"] = player["y"]
            }
            else{
              player["y"] -= 10;
            }
          }
        
        });
      
      var rect1 = {
        x: c.width,
        y: Math.floor(Math.random()*c.height),
        w: 60,
        h: 40,
        color: "red"
      }
      
      var rect2= {
        x: c.width,
        y: Math.floor(Math.random()*c.height),
        w: 60,
        h: 40,
        color: "green"
      }
      
      var objects = [rect1, rect2]
      
      
      
      
      const draw = () => {

        //clear
        ctx.clearRect(0,0,c.width,c.height);
        
        
        
        //draw
        ctx.beginPath();
        ctx.fillStyle = "black";
        ctx.rect(player["x"], player["y"], player["w"],player["h"]);
        ctx.closePath();
        ctx.stroke();
        ctx.fill();
        
        for (i in objects){ 
          let rect = objects[i];
          rect.x -= 5
          
          if(rect.x < rect.w){
            rect.y = Math.floor(Math.random()*c.height);
            rect.x = c.width;
          }                   
          

          drawFilledRectangle(rect.x, rect.y, rect.w, rect.h,rect.color);
        }       
        
        
        //repeat
        window.requestAnimationFrame(draw);
      }
      
      draw();
      
    </script>

  </body>

</html>